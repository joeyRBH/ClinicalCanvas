<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClinicalCanvas EHR</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="auth-container" id="authContainer">
        <h2>ClinicalCanvas Login</h2>
        <input type="text" id="username" placeholder="Username" class="input">
        <input type="password" id="password" placeholder="Password" class="input">
        <button onclick="login()" class="btn btn-primary">Login</button>
        <p style="margin-top: 20px; font-size: 12px; color: #666;">Demo: admin/admin123 or client/client123</p>
    </div>

    <div class="app-container" id="appContainer">
        <div class="header">
            <h1>üè• ClinicalCanvas EHR</h1>
            <div class="user-info">
                <span id="userName"></span>
                <button onclick="logout()" class="btn">Logout</button>
            </div>
        </div>

        <div class="tabs" id="mainTabs">
            <button class="tab-btn active" onclick="showTab('dashboard')">Dashboard</button>
            <button class="tab-btn" onclick="showTab('clients')">Clients</button>
            <button class="tab-btn" onclick="showTab('calendar')">Calendar</button>
            <button class="tab-btn" onclick="showTab('billing')">Billing</button>
            <button class="tab-btn" onclick="showTab('documents')">Documents</button>
            <button class="tab-btn" onclick="showTab('audit')">Audit Log</button>
        </div>

        <div class="content">
            <!-- Dashboard / Client Portal -->
            <div id="dashboardContent" class="tab-content" style="display: block;">
                <div class="content-header">
                    <h2 id="dashboardTitle">Dashboard</h2>
                </div>
                <div id="dashboardContainer"></div>
            </div>

            <!-- Clients -->
            <div id="clientsContent" class="tab-content">
                <div class="content-header">
                    <h2>Client Management</h2>
                    <button onclick="openNewClient()" class="btn btn-primary">+ New Client</button>
                </div>
                <div id="clientsList" class="grid"></div>
            </div>

            <!-- Calendar -->
            <div id="calendarContent" class="tab-content">
                <div class="content-header">
                    <h2>Calendar</h2>
                    <button onclick="openNewAppointment()" class="btn btn-primary">+ New Appointment</button>
                </div>
                
                <div class="calendar-header">
                    <button onclick="previousMonth()" class="btn">‚Üê Previous</button>
                    <h3 id="currentMonthYear"></h3>
                    <button onclick="nextMonth()" class="btn">Next ‚Üí</button>
                </div>
                
                <div class="calendar-grid" id="calendarGrid"></div>
                
                <div style="margin-top: 30px;">
                    <h3 style="color: white; margin-bottom: 20px;">All Appointments</h3>
                    <div id="appointmentsList"></div>
                </div>
            </div>

            <!-- Billing -->
            <div id="billingContent" class="tab-content">
                <div class="content-header">
                    <h2>Billing & Invoices</h2>
                </div>
                <div id="billingList"></div>
            </div>

            <!-- Documents -->
            <div id="documentsContent" class="tab-content">
                <div class="content-header">
                    <h2>Clinical Documents</h2>
                    <button onclick="openAssignDoc()" class="btn btn-primary" id="assignDocBtn">+ Assign Document</button>
                </div>
                <div id="assignedDocsList"></div>
            </div>

            <!-- Audit Log -->
            <div id="auditContent" class="tab-content">
                <div class="content-header">
                    <h2>HIPAA Audit Log</h2>
                </div>
                <div id="auditLogList"></div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    
    <!-- New Client Modal -->
    <div id="newClientModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeNewClient()">&times;</span>
            <h2>New Client</h2>
            <input type="text" id="clientName" placeholder="Full Name" class="input">
            <input type="email" id="clientEmail" placeholder="Email" class="input">
            <input type="tel" id="clientPhone" placeholder="Phone" class="input">
            <input type="date" id="clientDOB" placeholder="Date of Birth" class="input">
            <textarea id="clientNotes" placeholder="Initial Notes" class="input"></textarea>
            <button onclick="saveNewClient()" class="btn btn-primary">Save Client</button>
        </div>
    </div>

    <!-- Client Chart Modal -->
    <div id="clientChartModal" class="modal">
        <div class="modal-content" style="max-width: 1000px;">
            <span class="close" onclick="closeClientChart()">&times;</span>
            <h2 id="chartClientName"></h2>
            
            <div class="chart-tabs">
                <button class="chart-tab-btn active" onclick="showChartTab('info')">Info</button>
                <button class="chart-tab-btn" onclick="showChartTab('appointments')">Appointments</button>
                <button class="chart-tab-btn" onclick="showChartTab('notes')">Clinical Notes</button>
                <button class="chart-tab-btn" onclick="showChartTab('diagnosis')">Diagnosis</button>
            </div>

            <div id="chartInfo" class="chart-section active">
                <div class="card">
                    <h3>Client Information</h3>
                    <p><strong>Email:</strong> <span id="chartEmail"></span></p>
                    <p><strong>Phone:</strong> <span id="chartPhone"></span></p>
                    <p><strong>Date of Birth:</strong> <span id="chartDOB"></span></p>
                    <p><strong>Notes:</strong> <span id="chartNotes"></span></p>
                </div>
            </div>

            <div id="chartAppointments" class="chart-section">
                <button onclick="openNewAppointmentForClient()" class="btn btn-primary" style="margin-bottom: 20px;">+ New Appointment</button>
                <div id="clientAppointmentsList"></div>
            </div>

            <div id="chartNotes" class="chart-section">
                <div id="clientNotesList"></div>
            </div>

            <div id="chartDiagnosis" class="chart-section">
                <button onclick="openAddDiagnosis()" class="btn btn-primary" style="margin-bottom: 20px;">+ Add Diagnosis</button>
                <div id="clientDiagnosisList"></div>
            </div>
        </div>
    </div>

    <!-- New/Edit Appointment Modal -->
    <div id="newAppointmentModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close" onclick="closeNewAppointment()">&times;</span>
            <h2 id="appointmentModalTitle">New Appointment</h2>
            
            <input type="hidden" id="editAppointmentId">
            
            <select id="appointmentClient" class="input">
                <option value="">Select Client</option>
            </select>
            <input type="date" id="appointmentDate" class="input">
            <input type="time" id="appointmentTime" class="input">
            <select id="appointmentType" class="input">
                <option value="">Select Type</option>
                <option value="90791">90791 - Psychiatric Diagnostic Evaluation</option>
                <option value="90834">90834 - Psychotherapy 45 min</option>
                <option value="90837">90837 - Psychotherapy 60 min</option>
                <option value="90847">90847 - Family Psychotherapy</option>
                <option value="90853">90853 - Group Psychotherapy</option>
            </select>
            <input type="number" id="appointmentDuration" placeholder="Duration (minutes)" class="input" value="60">
            
            <!-- AI Note Taker Section -->
            <div class="ai-note-section">
                <h3>üéôÔ∏è Session Recording & AI Note Generator</h3>
                <p style="font-size: 14px; color: #666; margin-bottom: 15px;">Record your entire therapy session here. The AI will help generate a professional DAP note.</p>
                
                <textarea id="sessionRecording" placeholder="Paste or type the full session transcript/recording here...

Example: Client arrived on time and appeared anxious. We discussed their work stress and relationship concerns. Client reported improved sleep after trying the relaxation techniques. We practiced cognitive reframing around their negative self-talk..." 
                    class="input" style="min-height: 200px;"></textarea>
                
                <button onclick="generateAINote()" class="btn btn-primary" style="margin-bottom: 15px;">ü§ñ Generate DAP Note with AI</button>
                
                <h4 style="margin-top: 20px; margin-bottom: 10px;">Clinical Note (DAP Format):</h4>
                
                <label style="font-weight: 600; display: block; margin-bottom: 5px;">DATA (Observations):</label>
                <textarea id="noteData" placeholder="What happened in session? Client's presentation, behaviors, topics discussed..." class="input"></textarea>
                
                <label style="font-weight: 600; display: block; margin-bottom: 5px;">ASSESSMENT (Clinical Assessment):</label>
                <textarea id="noteAssessment" placeholder="Clinical interpretation, progress toward goals, risk assessment..." class="input"></textarea>
                
                <label style="font-weight: 600; display: block; margin-bottom: 5px;">PLAN (Treatment Plan):</label>
                <textarea id="notePlan" placeholder="Interventions, homework, next session goals..." class="input"></textarea>
            </div>
            
            <div style="display: flex; gap: 10px;">
                <button onclick="saveNewAppointment()" class="btn btn-primary">Save Appointment</button>
                <button onclick="deleteAppointment()" class="btn btn-danger" id="deleteAppointmentBtn" style="display: none;">Delete</button>
            </div>
        </div>
    </div>

    <!-- Add Diagnosis Modal -->
    <div id="addDiagnosisModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAddDiagnosis()">&times;</span>
            <h2>Add Diagnosis</h2>
            <select id="diagnosisCode" class="input">
                <option value="">Select ICD-10 Code</option>
            </select>
            <textarea id="diagnosisNotes" placeholder="Clinical notes about this diagnosis" class="input"></textarea>
            <button onclick="saveDiagnosis()" class="btn btn-primary">Add Diagnosis</button>
        </div>
    </div>

    <!-- Assign Document Modal -->
    <div id="assignDocModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAssignDoc()">&times;</span>
            <h2>Assign Document</h2>
            <select id="assignDocClient" class="input">
                <option value="">Select Client</option>
            </select>
            <select id="assignDocTemplate" class="input">
                <option value="">Select Document</option>
            </select>
            <button onclick="saveAssignDoc()" class="btn btn-primary">Assign Document</button>
        </div>
    </div>

    <!-- Fill Document Modal -->
    <div id="fillDocModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <span class="close" onclick="closeFillDocModal()">&times;</span>
            <h2 id="fillDocTitle"></h2>
            <div id="fillDocForm"></div>
            <div style="margin-top: 20px;">
                <h3>Signature</h3>
                <canvas id="signatureCanvas" width="500" height="150" style="border: 2px solid #ddd; border-radius: 4px; cursor: crosshair;"></canvas>
                <div style="margin-top: 10px;">
                    <button onclick="clearSignature()" class="btn">Clear Signature</button>
                    <button onclick="submitDocument()" class="btn btn-primary">Submit Document</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Document Modal -->
    <div id="viewDocModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <span class="close" onclick="closeViewDocModal()">&times;</span>
            <h2 id="viewDocTitle"></h2>
            <div id="viewDocContent"></div>
            
            <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #e5e5e5;">
                <h3>Clinician Review Signature</h3>
                <p style="margin-bottom: 15px; color: #666;">By signing below, you acknowledge that you have reviewed this completed document.</p>
                <canvas id="clinicianSignatureCanvas" width="500" height="150" style="border: 2px solid #ddd; border-radius: 4px; cursor: crosshair; display: block; margin-bottom: 15px;"></canvas>
                <div style="display: flex; gap: 10px;">
                    <button onclick="clearClinicianSignature()" class="btn">Clear</button>
                    <button onclick="saveClinicianSignature()" class="btn btn-primary">Save Review Signature</button>
                </div>
                <p id="clinicianSignatureTimestamp" style="margin-top: 10px; font-size: 12px; color: #666;"></p>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePaymentModal()">&times;</span>
            <h2>Process Payment</h2>
            
            <div class="payment-section">
                <div class="payment-amount">Amount Due: $<span id="paymentAmount">0.00</span></div>
                
                <div class="payment-methods">
                    <div class="payment-method selected" onclick="selectPaymentMethod('card')" id="cardMethod">
                        <strong>üí≥ Credit Card</strong>
                        <p style="font-size: 12px; margin-top: 5px;">Visa, MC, Amex</p>
                    </div>
                    <div class="payment-method" onclick="selectPaymentMethod('ach')" id="achMethod">
                        <strong>üè¶ Bank Transfer</strong>
                        <p style="font-size: 12px; margin-top: 5px;">ACH Transfer</p>
                    </div>
                </div>
                
                <div id="cardPaymentForm" class="payment-form">
                    <input type="text" id="cardholderName" placeholder="Cardholder Name" class="input">
                    <input type="text" id="cardNumber" placeholder="Card Number" class="input" maxlength="19">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <input type="text" id="cardExpiry" placeholder="MM/YY" class="input" maxlength="5">
                        <input type="text" id="cardCVV" placeholder="CVV" class="input" maxlength="4">
                    </div>
                    <input type="text" id="billingZip" placeholder="Billing ZIP Code" class="input" maxlength="10">
                </div>
                
                <div id="achPaymentForm" class="payment-form" style="display: none;">
                    <input type="text" id="accountHolderName" placeholder="Account Holder Name" class="input">
                    <input type="text" id="routingNumber" placeholder="Routing Number" class="input" maxlength="9">
                    <input type="text" id="accountNumber" placeholder="Account Number" class="input">
                    <select id="accountType" class="input">
                        <option value="">Select Account Type</option>
                        <option value="checking">Checking</option>
                        <option value="savings">Savings</option>
                    </select>
                </div>
                
                <button onclick="processPayment()" class="btn btn-primary" style="width: 100%;">üí∞ Process Payment</button>
                <p style="margin-top: 15px; font-size: 12px; color: #666; text-align: center;">
                    üîí Secure payment processing ‚Ä¢ PCI DSS compliant
                </p>
            </div>
        </div>
    </div>

<script src="app.js"></script>
</body>
</html>
