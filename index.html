<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClinicalCanvas EHR - Clinical Documents</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            min-height: 100vh;
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 400px;
        }

        .login-box h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .login-box p {
            color: #666;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group input[type="checkbox"], .form-group input[type="radio"] {
            width: auto;
            margin-right: 8px;
        }

        .checkbox-group, .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .checkbox-item, .radio-item {
            display: flex;
            align-items: center;
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            box-shadow: 0 10px 20px rgba(108, 117, 125, 0.3);
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            box-shadow: 0 10px 20px rgba(40, 167, 69, 0.3);
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            box-shadow: 0 10px 20px rgba(220, 53, 69, 0.3);
        }

        .app-container {
            display: none;
            min-height: 100vh;
            background: #f5f7fa;
        }

        .app-container.active {
            display: block;
        }

        .header {
            background: white;
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 24px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info span {
            color: #333;
            font-weight: 500;
        }

        .logout-btn {
            padding: 8px 20px;
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
        }

        .logout-btn:hover {
            background: #ff3838;
        }

        .main-content {
            display: flex;
            min-height: calc(100vh - 80px);
        }

        .sidebar {
            width: 250px;
            background: white;
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
        }

        .nav-item {
            padding: 12px 15px;
            margin-bottom: 5px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
            color: #333;
            font-weight: 500;
        }

        .nav-item:hover {
            background: #f0f0f0;
        }

        .nav-item.active {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
        }

        .content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        .card h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .card h3 {
            color: #555;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            text-align: center;
        }

        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-card .number {
            color: #667eea;
            font-size: 32px;
            font-weight: 700;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e0e0e0;
        }

        .table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
            color: #555;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-pending {
            background: #fff3cd;
            color: #856404;
        }

        .badge-completed {
            background: #d4edda;
            color: #155724;
        }

        .badge-signed {
            background: #d1ecf1;
            color: #0c5460;
        }

        .action-btn {
            padding: 6px 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            margin-right: 5px;
        }

        .action-btn:hover {
            background: #5568d3;
        }

        .action-btn.delete {
            background: #dc3545;
        }

        .action-btn.delete:hover {
            background: #c82333;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #333;
            font-size: 24px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #999;
        }

        .close-btn:hover {
            color: #333;
        }

        .document-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .document-item {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .document-item:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .document-item.selected {
            border-color: #667eea;
            background: #f0f3ff;
        }

        .document-item h4 {
            color: #333;
            margin-bottom: 5px;
        }

        .document-item p {
            color: #666;
            font-size: 13px;
        }

        .signature-pad {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: crosshair;
            touch-action: none;
        }

        .signature-controls {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }

        .form-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .form-section:last-child {
            border-bottom: none;
        }

        .form-section h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .required {
            color: #dc3545;
        }

        .signature-box {
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background: #f8f9ff;
        }

        .signature-image {
            max-width: 300px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
        }

        .timestamp {
            color: #666;
            font-size: 13px;
            font-style: italic;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .document-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <h1>ClinicalCanvas</h1>
            <p>Secure EHR Portal</p>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="loginEmail" placeholder="Enter your email">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="loginPassword" placeholder="Enter your password">
            </div>
            <button class="btn" onclick="login()">Login</button>
        </div>
    </div>

    <!-- App Container -->
    <div class="app-container" id="appContainer">
        <div class="header">
            <h1>ClinicalCanvas EHR</h1>
            <div class="user-info">
                <span id="currentUserName"></span>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>

        <div class="main-content">
            <div class="sidebar" id="sidebar"></div>
            <div class="content" id="content"></div>
        </div>
    </div>

    <!-- Assign Documents Modal -->
    <div class="modal" id="assignDocsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Assign Documents</h2>
                <button class="close-btn" onclick="closeModal('assignDocsModal')">&times;</button>
            </div>
            <div class="form-group">
                <label>Select Client</label>
                <select id="assignClientSelect"></select>
            </div>
            <div class="document-list" id="documentListForAssign"></div>
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button class="btn" onclick="assignSelectedDocuments()">Assign Selected</button>
                <button class="btn btn-secondary" onclick="closeModal('assignDocsModal')">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Complete Document Modal -->
    <div class="modal" id="completeDocModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="docTitle"></h2>
                <button class="close-btn" onclick="closeModal('completeDocModal')">&times;</button>
            </div>
            <div id="docFormContent"></div>
        </div>
    </div>

    <script>
        // Global state
        let currentUser = null;
        let currentPage = 'dashboard';
        let clients = [
            { id: 1, name: 'John Smith', email: 'john@email.com', phone: '555-0123' },
            { id: 2, name: 'Sarah Johnson', email: 'sarah@email.com', phone: '555-0125' }
        ];

        // Document templates
        const documentTemplates = [
            { 
                id: 1, 
                name: 'Adult ADHD Self-Report Scale (ASRS-v1.1)', 
                category: 'Assessment',
                fields: [
                    { type: 'section', title: 'Part A' },
                    { type: 'radio', label: '1. How often do you have trouble wrapping up the final details of a project, once the challenging parts have been done?', options: ['Never (0)', 'Rarely (0)', 'Sometimes (1)', 'Often (1)', 'Very Often (1)'], required: true },
                    { type: 'radio', label: '2. How often do you have difficulty getting things in order when you have to do a task that requires organization?', options: ['Never (0)', 'Rarely (0)', 'Sometimes (1)', 'Often (1)', 'Very Often (1)'], required: true },
                    { type: 'radio', label: '3. How often do you have problems remembering appointments or obligations?', options: ['Never (0)', 'Rarely (0)', 'Sometimes (1)', 'Often (1)', 'Very Often (1)'], required: true },
                    { type: 'radio', label: '4. When you have a task that requires a lot of thought, how often do you avoid or delay getting started?', options: ['Never (0)', 'Rarely (0)', 'Sometimes (0)', 'Often (1)', 'Very Often (1)'], required: true },
                    { type: 'radio', label: '5. How often do you fidget or squirm with your hands or feet when you have to sit down for a long time?', options: ['Never (0)', 'Rarely (0)', 'Sometimes (0)', 'Often (1)', 'Very Often (1)'], required: true },
                    { type: 'radio', label: '6. How often do you feel overly active and compelled to do things, like you were driven by a motor?', options: ['Never (0)', 'Rarely (0)', 'Sometimes (0)', 'Often (1)', 'Very Often (1)'], required: true },
                    { type: 'text', label: 'Total Score for Part A:', required: true },
                    { type: 'section', title: 'Part B' },
                    { type: 'radio', label: '7. How often do you make careless mistakes when you have to work on a boring or difficult project?', options: ['Never (0)', 'Rarely (0)', 'Sometimes (0)', 'Often (1)', 'Very Often (1)'], required: true },
                    { type: 'radio', label: '8. How often do you have difficulty keeping your attention when you are doing boring or repetitive work?', options: ['Never (0)', 'Rarely (0)', 'Sometimes (0)', 'Often (1)', 'Very Often (1)'], required: true },
                    { type: 'text', label: 'Total Score for Part B:', required: true }
                ]
            },
            { 
                id: 2, 
                name: 'Adverse Childhood Experience (ACE) Questionnaire', 
                category: 'Assessment',
                fields: [
                    { type: 'section', title: 'While you were growing up, during your first 18 years of life:' },
                    { type: 'radio', label: '1. Did a parent or other adult in the household often swear at you, insult you, put you down, or humiliate you? Did they act in a way that made you afraid that you might be physically hurt?', options: ['Yes (1)', 'No (0)'], required: true },
                    { type: 'radio', label: '2. Did a parent or other adult in the household often push, grab, slap, or throw something at you? Did they ever hit you so hard that you had marks or were injured?', options: ['Yes (1)', 'No (0)'], required: true },
                    { type: 'radio', label: '3. Did an adult or person at least 5 years older than you ever touch or fondle you or have you touch their body in a sexual way?', options: ['Yes (1)', 'No (0)'], required: true },
                    { type: 'radio', label: '4. Did you often feel that no one in your family loved you or thought you were important or special?', options: ['Yes (1)', 'No (0)'], required: true },
                    { type: 'radio', label: '5. Did you often feel that you didn\'t have enough to eat, had to wear dirty clothes, and had no one to protect you?', options: ['Yes (1)', 'No (0)'], required: true },
                    { type: 'radio', label: '6. Were your parents ever separated or divorced?', options: ['Yes (1)', 'No (0)'], required: true },
                    { type: 'radio', label: '7. Was your mother or stepmother often pushed, grabbed, slapped, or had something thrown at her?', options: ['Yes (1)', 'No (0)'], required: true },
                    { type: 'radio', label: '8. Did you live with anyone who was a problem drinker or alcoholic or who used street drugs?', options: ['Yes (1)', 'No (0)'], required: true },
                    { type: 'radio', label: '9. Was a household member depressed or mentally ill or did a household member attempt suicide?', options: ['Yes (1)', 'No (0)'], required: true },
                    { type: 'radio', label: '10. Did a household member go to prison?', options: ['Yes (1)', 'No (0)'], required: true },
                    { type: 'text', label: 'Total ACE Score:', required: true }
                ]
            },
            { 
                id: 3, 
                name: 'Individual Intake Questionnaire', 
                category: 'Intake',
                fields: [
                    { type: 'textarea', label: 'How did you find me as your therapist?', required: true },
                    { type: 'textarea', label: 'What is the reason you are coming in for counseling?', required: true },
                    { type: 'textarea', label: 'What are your goals for our work together?', required: true },
                    { type: 'radio', label: 'Do you have, or have you ever had, a problem with self-harm?', options: ['Yes', 'No'], required: true },
                    { type: 'radio', label: 'Do you have, or have you ever had, suicidal thoughts?', options: ['Yes', 'No'], required: true },
                    { type: 'radio', label: 'Is there a history of mental illness in your family?', options: ['Yes', 'No'], required: true },
                    { type: 'text', label: 'How many hours of sleep do you typically get?', required: true },
                    { type: 'textarea', label: 'What do you like to do for fun or enjoyment?', required: true }
                ]
            },
            { 
                id: 4, 
                name: 'Informed Consent for Psychotherapy', 
                category: 'Consent',
                fields: [
                    { type: 'section', title: 'General Information' },
                    { type: 'info', content: 'The therapeutic relationship is unique in that it is a highly personal and at the same time, a contractual agreement. This consent will provide a clear framework for our work together.' },
                    { type: 'section', title: 'Confidentiality' },
                    { type: 'info', content: 'The session content and all relevant materials to your treatment will be held confidential unless you request in writing to have all or portions released to a specifically named person/persons.' },
                    { type: 'checkbox', label: 'I have read and understood the confidentiality policy', required: true },
                    { type: 'checkbox', label: 'I understand the limitations of confidentiality', required: true },
                    { type: 'checkbox', label: 'I agree to the terms outlined in this consent', required: true }
                ]
            },
            { 
                id: 5, 
                name: 'Notice of Privacy Practices', 
                category: 'HIPAA',
                fields: [
                    { type: 'section', title: 'HIPAA Notice of Privacy Practices' },
                    { type: 'info', content: 'This notice describes how health information may be used and disclosed and how you can get access to this information.' },
                    { type: 'checkbox', label: 'I acknowledge that I have received a copy of the HIPAA Notice of Privacy Practices', required: true },
                    { type: 'checkbox', label: 'I understand my rights regarding my protected health information', required: true }
                ]
            },
            { 
                id: 6, 
                name: 'Authorization for Disclosure of Information', 
                category: 'HIPAA',
                fields: [
                    { type: 'text', label: 'I hereby authorize and direct (enter name of clinician):', required: true },
                    { type: 'radio', label: 'To:', options: ['DISCLOSE the following information', 'EXCHANGE the following information'], required: true },
                    { type: 'textarea', label: 'To / With:', required: true },
                    { type: 'textarea', label: 'For the following purpose(s):' },
                    { type: 'date', label: 'This authorization expires on:', required: true }
                ]
            },
            { 
                id: 7, 
                name: 'Consent for Use of AI Tools in Therapy Services', 
                category: 'Consent',
                fields: [
                    { type: 'section', title: 'Consent for Use of Artificial Intelligence (AI) Tools' },
                    { type: 'info', content: 'This document explains how we use AI tools and asks for your consent to use them as part of your treatment.' },
                    { type: 'radio', label: 'I consent to the use of an AI transcription tool to record and transcribe my therapy sessions', options: ['I consent', 'I do not consent'], required: true },
                    { type: 'checkbox', label: 'I have read and understood this form', required: true },
                    { type: 'checkbox', label: 'I have had the opportunity to ask questions about the use of AI tools', required: true },
                    { type: 'checkbox', label: 'I voluntarily agree to the use of AI tools for the purposes described', required: true }
                ]
            },
            {
                id: 8,
                name: 'Biopsychosocial Assessment',
                category: 'Assessment',
                fields: [
                    { type: 'textarea', label: '1. Presenting Problem:', required: true },
                    { type: 'textarea', label: '2. Signs and Symptoms (DSM-V-TR based):', required: true },
                    { type: 'textarea', label: '3. History of Presenting Problem:', required: true },
                    { type: 'textarea', label: 'Family mental health history:' },
                    { type: 'textarea', label: '4. Current Family and Significant Relationships - Strengths/support:' },
                    { type: 'textarea', label: 'Stressors/problems:' },
                    { type: 'textarea', label: '5. Childhood/Adolescent History:' },
                    { type: 'textarea', label: '6. Social Relationships - Strengths/support:' },
                    { type: 'textarea', label: '7. Cultural/Ethnic considerations:' },
                    { type: 'textarea', label: '8. Spiritual/Religious considerations:' }
                ]
            }
        ];

        // Assigned documents (clientId -> array of assigned docs)
        let assignedDocuments = {};
        
        // Completed documents
        let completedDocuments = [];

        // Authentication
        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (email === 'therapist@clinic.com' && password === 'therapist') {
                currentUser = { email, name: 'Dr. Smith', role: 'therapist' };
            } else if (email === 'john@email.com' && password === 'client') {
                currentUser = { email, name: 'John Smith', role: 'client', id: 1 };
            } else if (email === 'sarah@email.com' && password === 'client') {
                currentUser = { email, name: 'Sarah Johnson', role: 'client', id: 2 };
            } else {
                alert('Invalid credentials. Try:\nTherapist: therapist@clinic.com / therapist\nClient: john@email.com / client');
                return;
            }

            document.getElementById('loginContainer').classList.remove('active');
            document.getElementById('appContainer').classList.add('active');
            document.getElementById('currentUserName').textContent = currentUser.name;
            
            renderSidebar();
            renderPage(currentPage);
        }

        function logout() {
            currentUser = null;
            document.getElementById('loginContainer').classList.add('active');
            document.getElementById('appContainer').classList.remove('active');
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
        }

        // Render sidebar based on role
        function renderSidebar() {
            const sidebar = document.getElementById('sidebar');
            let navItems = [];

            if (currentUser.role === 'therapist') {
                navItems = [
                    { id: 'dashboard', label: 'Dashboard' },
                    { id: 'clients', label: 'Clients' },
                    { id: 'documents', label: 'Clinical Documents' },
                    { id: 'assigned-docs', label: 'Assigned Documents' }
                ];
            } else {
                navItems = [
                    { id: 'client-dashboard', label: 'Dashboard' },
                    { id: 'my-documents', label: 'My Documents' }
                ];
            }

            sidebar.innerHTML = navItems.map(item => `
                <div class="nav-item ${currentPage === item.id ? 'active' : ''}" 
                     onclick="navigateTo('${item.id}')">
                    ${item.label}
                </div>
            `).join('');
        }

        function navigateTo(page) {
            currentPage = page;
            renderSidebar();
            renderPage(page);
        }

        // Render page content
        function renderPage(page) {
            const content = document.getElementById('content');
            
            if (currentUser.role === 'therapist') {
                switch(page) {
                    case 'dashboard':
                        renderTherapistDashboard(content);
                        break;
                    case 'clients':
                        renderClientsPage(content);
                        break;
                    case 'documents':
                        renderDocumentsPage(content);
                        break;
                    case 'assigned-docs':
                        renderAssignedDocsPage(content);
                        break;
                }
            } else {
                switch(page) {
                    case 'client-dashboard':
                        renderClientDashboard(content);
                        break;
                    case 'my-documents':
                        renderMyDocumentsPage(content);
                        break;
                }
            }
        }

        function renderTherapistDashboard(content) {
            const totalClients = clients.length;
            const totalAssigned = Object.values(assignedDocuments).reduce((sum, docs) => sum + docs.length, 0);
            const totalCompleted = completedDocuments.length;
            const pendingDocs = totalAssigned - totalCompleted;

            content.innerHTML = `
                <div class="card">
                    <h2>Dashboard</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Total Clients</h3>
                            <div class="number">${totalClients}</div>
                        </div>
                        <div class="stat-card">
                            <h3>Documents Assigned</h3>
                            <div class="number">${totalAssigned}</div>
                        </div>
                        <div class="stat-card">
                            <h3>Completed</h3>
                            <div class="number">${totalCompleted}</div>
                        </div>
                        <div class="stat-card">
                            <h3>Pending</h3>
                            <div class="number">${pendingDocs}</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>Recent Activity</h2>
                    <p style="color: #666;">Document activity will appear here</p>
                </div>
            `;
        }

        function renderClientsPage(content) {
            content.innerHTML = `
                <div class="card">
                    <h2>Clients</h2>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Assigned Docs</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${clients.map(client => `
                                <tr>
                                    <td>${client.name}</td>
                                    <td>${client.email}</td>
                                    <td>${client.phone}</td>
                                    <td>${(assignedDocuments[client.id] || []).length}</td>
                                    <td>
                                        <button class="action-btn" onclick="openAssignDocsModal(${client.id})">
                                            Assign Documents
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function renderDocumentsPage(content) {
            const categories = [...new Set(documentTemplates.map(d => d.category))];
            
            let html = '<div class="card"><h2>Clinical Documents Library</h2>';
            
            categories.forEach(category => {
                const docs = documentTemplates.filter(d => d.category === category);
                html += `
                    <div class="form-section">
                        <h3>${category}</h3>
                        <div class="document-list">
                            ${docs.map(doc => `
                                <div class="document-item">
                                    <h4>${doc.name}</h4>
                                    <p>${doc.fields.length} fields</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            content.innerHTML = html;
        }

        function renderAssignedDocsPage(content) {
            let rows = [];
            
            for (let clientId in assignedDocuments) {
                const client = clients.find(c => c.id == clientId);
                const docs = assignedDocuments[clientId];
                
                docs.forEach(doc => {
                    const template = documentTemplates.find(t => t.id === doc.docId);
                    const completed = completedDocuments.find(cd => 
                        cd.clientId == clientId && cd.docId === doc.docId && cd.assignmentId === doc.id
                    );
                    
                    rows.push(`
                        <tr>
                            <td>${client.name}</td>
                            <td>${template.name}</td>
                            <td>${new Date(doc.assignedDate).toLocaleDateString()}</td>
                            <td>
                                ${completed ? 
                                    `<span class="badge badge-completed">Completed</span>` :
                                    `<span class="badge badge-pending">Pending</span>`
                                }
                            </td>
                            <td>
                                ${completed ? 
                                    `<button class="action-btn" onclick="viewCompletedDocument(${completed.id})">View</button>` :
                                    `<span style="color: #999;">Awaiting client</span>`
                                }
                            </td>
                        </tr>
                    `);
                });
            }

            content.innerHTML = `
                <div class="card">
                    <h2>Assigned Documents</h2>
                    ${rows.length > 0 ? `
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Client</th>
                                    <th>Document</th>
                                    <th>Assigned Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${rows.join('')}
                            </tbody>
                        </table>
                    ` : '<p style="color: #666;">No documents assigned yet</p>'}
                </div>
            `;
        }

        function renderClientDashboard(content) {
            const myDocs = assignedDocuments[currentUser.id] || [];
            const myCompleted = completedDocuments.filter(cd => cd.clientId === currentUser.id);
            const pending = myDocs.length - myCompleted.length;

            content.innerHTML = `
                <div class="card">
                    <h2>Welcome, ${currentUser.name}</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Documents Assigned</h3>
                            <div class="number">${myDocs.length}</div>
                        </div>
                        <div class="stat-card">
                            <h3>Completed</h3>
                            <div class="number">${myCompleted.length}</div>
                        </div>
                        <div class="stat-card">
                            <h3>Pending</h3>
                            <div class="number">${pending}</div>
                        </div>
                    </div>
                </div>

                ${pending > 0 ? `
                    <div class="card" style="background: #fff3cd; border-left: 4px solid #ffc107;">
                        <h3 style="color: #856404;">Action Required</h3>
                        <p style="color: #856404;">You have ${pending} document(s) that need to be completed. Please visit "My Documents" to complete them.</p>
                    </div>
                ` : ''}
            `;
        }

        function renderMyDocumentsPage(content) {
            const myDocs = assignedDocuments[currentUser.id] || [];
            
            let rows = myDocs.map(doc => {
                const template = documentTemplates.find(t => t.id === doc.docId);
                const completed = completedDocuments.find(cd => 
                    cd.clientId === currentUser.id && cd.docId === doc.docId && cd.assignmentId === doc.id
                );
                
                return `
                    <tr>
                        <td>${template.name}</td>
                        <td>${new Date(doc.assignedDate).toLocaleDateString()}</td>
                        <td>
                            ${completed ? 
                                `<span class="badge badge-completed">Completed ${new Date(completed.completedDate).toLocaleDateString()}</span>` :
                                `<span class="badge badge-pending">Pending</span>`
                            }
                        </td>
                        <td>
                            ${completed ? 
                                `<button class="action-btn" onclick="viewCompletedDocument(${completed.id})">View</button>` :
                                `<button class="action-btn" onclick="openCompleteDocModal(${doc.id}, ${doc.docId})">Complete</button>`
                            }
                        </td>
                    </tr>
                `;
            });

            content.innerHTML = `
                <div class="card">
                    <h2>My Documents</h2>
                    ${rows.length > 0 ? `
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Document Name</th>
                                    <th>Assigned Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${rows.join('')}
                            </tbody>
                        </table>
                    ` : '<p style="color: #666;">No documents assigned to you yet</p>'}
                </div>
            `;
        }

        // Modal functions
        function openAssignDocsModal(clientId) {
            const modal = document.getElementById('assignDocsModal');
            const select = document.getElementById('assignClientSelect');
            const list = document.getElementById('documentListForAssign');
            
            // Populate client select
            select.innerHTML = clients.map(c => 
                `<option value="${c.id}" ${c.id === clientId ? 'selected' : ''}>${c.name}</option>`
            ).join('');
            
            // Render document list
            list.innerHTML = documentTemplates.map(doc => `
                <div class="document-item" data-doc-id="${doc.id}" onclick="toggleDocSelection(${doc.id})">
                    <h4>${doc.name}</h4>
                    <p>${doc.category}</p>
                </div>
            `).join('');
            
            modal.classList.add('active');
        }

        function toggleDocSelection(docId) {
            const item = document.querySelector(`[data-doc-id="${docId}"]`);
            item.classList.toggle('selected');
        }

        function assignSelectedDocuments() {
            const clientId = parseInt(document.getElementById('assignClientSelect').value);
            const selected = Array.from(document.querySelectorAll('.document-item.selected'));
            
            if (selected.length === 0) {
                alert('Please select at least one document');
                return;
            }
            
            if (!assignedDocuments[clientId]) {
                assignedDocuments[clientId] = [];
            }
            
            selected.forEach(item => {
                const docId = parseInt(item.dataset.docId);
                assignedDocuments[clientId].push({
                    id: Date.now() + Math.random(),
                    docId,
                    assignedDate: new Date().toISOString()
                });
            });
            
            alert(`${selected.length} document(s) assigned successfully!`);
            closeModal('assignDocsModal');
            renderPage(currentPage);
        }

        function openCompleteDocModal(assignmentId, docId) {
            const template = documentTemplates.find(t => t.id === docId);
            const modal = document.getElementById('completeDocModal');
            const title = document.getElementById('docTitle');
            const formContent = document.getElementById('docFormContent');
            
            title.textContent = template.name;
            
            let formHTML = '<form id="documentForm" onsubmit="saveCompletedDocument(event, ' + assignmentId + ', ' + docId + ')">';
            
            template.fields.forEach((field, index) => {
                if (field.type === 'section') {
                    formHTML += `<div class="form-section"><h3>${field.title}</h3></div>`;
                } else if (field.type === 'info') {
                    formHTML += `<div class="form-group"><p style="color: #666; font-style: italic;">${field.content}</p></div>`;
                } else if (field.type === 'text') {
                    formHTML += `
                        <div class="form-group">
                            <label>${field.label} ${field.required ? '<span class="required">*</span>' : ''}</label>
                            <input type="text" name="field_${index}" ${field.required ? 'required' : ''}>
                        </div>
                    `;
                } else if (field.type === 'textarea') {
                    formHTML += `
                        <div class="form-group">
                            <label>${field.label} ${field.required ? '<span class="required">*</span>' : ''}</label>
                            <textarea name="field_${index}" ${field.required ? 'required' : ''}></textarea>
                        </div>
                    `;
                } else if (field.type === 'date') {
                    formHTML += `
                        <div class="form-group">
                            <label>${field.label} ${field.required ? '<span class="required">*</span>' : ''}</label>
                            <input type="date" name="field_${index}" ${field.required ? 'required' : ''}>
                        </div>
                    `;
                } else if (field.type === 'radio') {
                    formHTML += `
                        <div class="form-group">
                            <label>${field.label} ${field.required ? '<span class="required">*</span>' : ''}</label>
                            <div class="radio-group">
                                ${field.options.map((opt, i) => `
                                    <div class="radio-item">
                                        <input type="radio" name="field_${index}" value="${opt}" id="field_${index}_${i}" ${field.required ? 'required' : ''}>
                                        <label for="field_${index}_${i}">${opt}</label>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                } else if (field.type === 'checkbox') {
                    formHTML += `
                        <div class="form-group">
                            <div class="checkbox-item">
                                <input type="checkbox" name="field_${index}" id="field_${index}" ${field.required ? 'required' : ''}>
                                <label for="field_${index}">${field.label} ${field.required ? '<span class="required">*</span>' : ''}</label>
                            </div>
                        </div>
                    `;
                }
            });
            
            formHTML += `
                <div class="form-section">
                    <h3>Digital Signature</h3>
                    <div class="signature-box">
                        <p>Draw your signature below:</p>
                        <canvas id="signaturePad" class="signature-pad" width="500" height="150"></canvas>
                        <div class="signature-controls">
                            <button type="button" class="btn btn-secondary" onclick="clearSignature()">Clear</button>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button type="submit" class="btn btn-success">Submit & Sign</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('completeDocModal')">Cancel</button>
                </div>
            </form>
            `;
            
            formContent.innerHTML = formHTML;
            modal.classList.add('active');
            
            // Initialize signature pad
            setTimeout(initSignaturePad, 100);
        }

        let isDrawing = false;
        let signatureCanvas = null;
        let signatureCtx = null;

        function initSignaturePad() {
            signatureCanvas = document.getElementById('signaturePad');
            signatureCtx = signatureCanvas.getContext('2d');
            
            signatureCanvas.addEventListener('mousedown', startDrawing);
            signatureCanvas.addEventListener('mousemove', draw);
            signatureCanvas.addEventListener('mouseup', stopDrawing);
            signatureCanvas.addEventListener('mouseout', stopDrawing);
            
            signatureCanvas.addEventListener('touchstart', handleTouch);
            signatureCanvas.addEventListener('touchmove', handleTouch);
            signatureCanvas.addEventListener('touchend', stopDrawing);
        }

        function startDrawing(e) {
            isDrawing = true;
            const rect = signatureCanvas.getBoundingClientRect();
            signatureCtx.beginPath();
            signatureCtx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        }

        function draw(e) {
            if (!isDrawing) return;
            const rect = signatureCanvas.getBoundingClientRect();
            signatureCtx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            signatureCtx.stroke();
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 'mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            signatureCanvas.dispatchEvent(mouseEvent);
        }

        function clearSignature() {
            signatureCtx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
        }

        function saveCompletedDocument(event, assignmentId, docId) {
            event.preventDefault();
            
            // Check if signature exists
            const imageData = signatureCtx.getImageData(0, 0, signatureCanvas.width, signatureCanvas.height);
            const hasSignature = imageData.data.some(channel => channel !== 0);
            
            if (!hasSignature) {
                alert('Please provide your signature before submitting');
                return;
            }
            
            // Collect form data
            const form = event.target;
            const formData = new FormData(form);
            const responses = {};
            
            for (let [key, value] of formData.entries()) {
                responses[key] = value;
            }
            
            // Save signature as base64
            const signatureData = signatureCanvas.toDataURL();
            
            // Create completed document record
            const completed = {
                id: Date.now(),
                clientId: currentUser.id,
                docId,
                assignmentId,
                responses,
                signature: signatureData,
                completedDate: new Date().toISOString(),
                signedDate: new Date().toISOString()
            };
            
            completedDocuments.push(completed);
            
            alert('Document completed and signed successfully!');
            closeModal('completeDocModal');
            renderPage(currentPage);
        }

        function viewCompletedDocument(completedId) {
            const completed = completedDocuments.find(cd => cd.id === completedId);
            const template = documentTemplates.find(t => t.id === completed.docId);
            const client = clients.find(c => c.id === completed.clientId);
            
            const modal = document.getElementById('completeDocModal');
            const title = document.getElementById('docTitle');
            const formContent = document.getElementById('docFormContent');
            
            title.textContent = template.name + ' (Completed)';
            
            let html = `<div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <p><strong>Client:</strong> ${client.name}</p>
                <p><strong>Completed:</strong> ${new Date(completed.completedDate).toLocaleString()}</p>
                <p><strong>Signed:</strong> ${new Date(completed.signedDate).toLocaleString()}</p>
            </div>`;
            
            template.fields.forEach((field, index) => {
                const response = completed.responses['field_' + index];
                
                if (field.type === 'section') {
                    html += `<div class="form-section"><h3>${field.title}</h3></div>`;
                } else if (field.type === 'info') {
                    html += `<div class="form-group"><p style="color: #666; font-style: italic;">${field.content}</p></div>`;
                } else {
                    html += `
                        <div class="form-group">
                            <label><strong>${field.label}</strong></label>
                            <p style="color: #333; margin-top: 5px;">${response || '(Not answered)'}</p>
                        </div>
                    `;
                }
            });
            
            html += `
                <div class="form-section">
                    <h3>Digital Signature</h3>
                    <img src="${completed.signature}" class="signature-image" alt="Client Signature">
                    <p class="timestamp">Signed on ${new Date(completed.signedDate).toLocaleString()}</p>
                </div>
                <button class="btn" onclick="closeModal('completeDocModal')">Close</button>
            `;
            
            formContent.innerHTML = html;
            modal.classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Initialize on page load
        window.onload = function() {
            document.getElementById('loginContainer').classList.add('active');
        };
    </script>
</body>
</html>
